#!/bin/bash
# XenonHD OTA

# Determine build properties
MODVERSION=`grep ro.xenonhd.version $OUT/system/build.prop | cut -d'=' -f2`
DEVICE=`grep ro.xenonhd.device $OUT/system/build.prop | cut -d'=' -f2`
OTA_TYPE=`grep ro.xenonhd.type $OUT/system/build.prop | cut -d'=' -f2`
VERSION=${OTA_TYPE,,}
TITLE=$DEVICE\_$VERSION

XENONHD_TARGET_PACKAGE=$MODVERSION-$DEVICE.zip

# Create OTA XML file
if [ -f $ANDROID_BUILD_TOP/out/ota_conf ]; then

cat >$OUT/ota_$TITLE.xml <<EOF
<?xml version="1.0" encoding="UTF-8"?>
<XenonOTA>
    <Oreo>
        <$DEVICE>
            <Filename>$MODVERSION</Filename>
            <RomUrl>https://mirrors.c0urier.net/android/teamhorizon/O/$OTA_TYPE/$DEVICE/$XENONHD_TARGET_PACKAGE</RomUrl>
            <MD5Url>https://mirrors.c0urier.net/android/teamhorizon/O/$OTA_TYPE/$DEVICE/$XENONHD_TARGET_PACKAGE.md5sum</MD5Url>
            <ChangelogUrl>https://mirrors.c0urier.net/android/teamhorizon/O/$OTA_TYPE/$DEVICE/Changelog.txt</ChangelogUrl>
        </$DEVICE>
    </Oreo>
</XenonOTA>
EOF
fi
